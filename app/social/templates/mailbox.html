{% extends 'base.html' %}
{% load static %}
{% load markdownify %}


{% block content %}

<style>
    .custom-profile-img {
        width: 80px;
        height: 80px;
        margin-right: 5px;
    }
</style>

<h2 class="mb-4 mx-1">Inbox</h2>

<!-- No notifications -->
{% if not follow_requests and not likes and not posts and not comments %}
    <div class="card mb-3">
        <div class="card-body">
            <h4 class="text-center">No notifications &#129300;</h4>
        </div>
    </div>
{% endif %}

<!-- Follow Requests -->
{% if follow_requests %}
    <h4 class="mb-4 mx-1">Follow Requests</h4>
    {% for req in follow_requests %}
        <div class="card post-card mb-2 p-1">
            <div class="card-body d-flex align-items-center">

                <!-- Profile Image & Info of follow request actor -->
                <div class="text-center">
                    {% if req.actor.profile_image_url %}
                        <img src="{{ req.actor.profile_image_url }}" 
                        alt="Profile Image" 
                        class="view-profile-img rounded-circle shadow-sm border custom-profile-img"
			style="width: 60px; height: 60px; object-fit: cover; border: 3px solid #ddd;"
                        onerror="this.src='https://35bff.yeg.rac.sh/static/images/default-profile.png'; this.onerror='';">
                    {% else %}
                        <img src="{% static 'images/default-profile.png' %}" 
                        alt="User" 
                        class="view-profile-img rounded-circle shadow-sm border custom-profile-img"
			style="width: 60px; height: 60px; object-fit: cover; border: 3px solid #ddd;">
                    {% endif %}
                </div>
                <div class="flex-grow-1 ms-3">
                    <h6>{{ req.actor.display_name|default:"Unnamed Author" }} requested to follow you</h6>
                    <p class="mb-0">Requested on: {{ req.request_date|date:"F j, Y, g:i a" }}</p>
                </div>

                <div>
                    <!-- Approve and Deny buttons -->
                    <form action="{% url 'accept_follow_request' request_id=req.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success me-2" style="font-size: 0.85rem;">Approve</button>
                    </form>
                    <form action="{% url 'deny_follow_request' request_id=req.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger" style="font-size: 0.85rem;">Deny</button>
                    </form>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
{% endif %}


<!-- Likes -->
{% if likes %}
    <h4 class="mb-4 mx-1">Likes</h4>
    {% for like in likes %}
        <div class="card post-card mb-2 p-1" style="font-size: 0.85rem;">
            <div class="card-body d-flex align-items-center">

                <!-- Profile Image & Info of Liker -->
                <div class="text-center">
                    {% if like.author.profile_image_url %}
                        <img src="{{ like.author.profile_image_url }}" 
                        alt="Profile Image" 
                        class="view-profile-img rounded-circle shadow-sm border custom-profile-img"
			style="width: 60px; height: 60px; object-fit: cover; border: 3px solid #ddd;"
                        onerror="this.src='https://35bff.yeg.rac.sh/static/images/default-profile.png'; this.onerror='';">
                    {% else %}
                        <img src="{% static 'images/default-profile.png' %}" 
                        alt="User" 
                        class="view-profile-img rounded-circle shadow-sm border custom-profile-img"
			style="width: 60px; height: 60px; object-fit: cover; border: 3px solid #ddd;">
                    {% endif %}
                </div>
                
                <!-- Changes text dependeding if the like was on a comment or post -->
                <div class="flex-grow-1 ms-3">
                    {% if like.content_object.title %}
                        <h6>{{ like.author.display_name|default:"Unnamed Author" }} liked your post "{{ like.content_object.title }}"</h6>
                    {% elif like.content_object.comment %}
                        <h6>{{ like.author.display_name|default:"Unnamed Author" }} liked your comment "{{ like.content_object.comment }}"</h6>
                    {% endif %}
                    <p class="mb-0">Liked on: {{ like.published|date:"F j, Y, g:i a" }}</p>
                </div>
                
                <!-- Delete from inbox buttons -->
                <div>
                    <form action="{% url 'delete_inbox_item' object_uuid=like.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger" style="font-size: 0.75rem;">Remove from inbox</button>
                    </form>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
{% endif %}


<!-- Posts -->
{% if posts %}
    <h4 class="mb-4 mx-1">Posts</h4>
    {% for post in posts %}
        <div class="card post-card mb-2 p-1" style="font-size: 0.75rem;">
            <div class="card-body d-flex align-items-center">

                <!-- Profile Image & Info of Poster -->
                <div class="text-center">
                    {% if post.author.profile_image_url %}
                        <img src="{{ post.author.profile_image_url }}" 
                        alt="Profile Image" 
                        class="view-profile-img rounded-circle shadow-sm border custom-profile-img"
			style="width: 60px; height: 60px; object-fit: cover; border: 3px solid #ddd;"
                        onerror="this.src='https://35bff.yeg.rac.sh/static/images/default-profile.png'; this.onerror='';">
                    {% else %}
                        <img src="{% static 'images/default-profile.png' %}" 
                        alt="User" 
                        class="view-profile-img rounded-circle shadow-sm border custom-profile-img"
			style="width: 60px; height: 60px; object-fit: cover; border: 3px solid #ddd;">
                    {% endif %}
                </div>
                <div class="flex-grow-1 ms-3">
                    <h6>{{ post.author.display_name|default:"Unnamed Author" }} posted "{{ post.title }}"</h6>
                    <p class="mb-0">Posted on: {{ post.published|date:"F j, Y, g:i a" }}</p>
                </div>
                
                <!-- Delete from inbox buttons -->
                <div>
                    <form action="{% url 'delete_inbox_item' object_uuid=post.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger" style="font-size: 0.75rem;">Remove from inbox</button>
                    </form>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
{% endif %}


<!-- Comments -->
{% if comments %}
    <h4 class="mb-4 mx-1">Comments</h4>
    {% for comment in comments %}
        <div class="card post-card mb-2 p-1" style="font-size: 0.75rem;">
            <div class="card-body d-flex align-items-center">
                
                <!-- Profile Image & Info of commenter -->
                <div class="text-center">
                    {% if comment.author.profile_image_url %}
                        <img src="{{ comment.author.profile_image_url }}" 
                        alt="Profile Image" 
                        class="view-profile-img rounded-circle shadow-sm border custom-profile-img"
			style="width: 60px; height: 60px; object-fit: cover; border: 3px solid #ddd;"
                        onerror="this.src='https://35bff.yeg.rac.sh/static/images/default-profile.png'; this.onerror='';">
                    {% else %}
                        <img src="{% static 'images/default-profile.png' %}" 
                        alt="User" 
                        class="view-profile-img rounded-circle shadow-sm border custom-profile-img"
			style="width: 60px; height: 60px; object-fit: cover; border: 3px solid #ddd;">
                    {% endif %}
                </div>
                <div class="flex-grow-1 ms-3">
                    <h6>{{ comment.author.display_name|default:"Unnamed Author" }} commented "{{ comment.comment }}" on "{{ comment.post.title }}"</h6>
                    <p class="mb-0">Commented on: {{ comment.published|date:"F j, Y, g:i a" }}</p>
                </div>

                <!-- Delete from inbox buttons -->
                <div>
                    <form action="{% url 'delete_inbox_item' object_uuid=comment.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger" style="font-size: 0.75rem;">Remove from inbox</button>
                    </form>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
{% endif %}

{% endblock %}
